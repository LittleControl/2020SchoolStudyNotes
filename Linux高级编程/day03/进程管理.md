# 进程管理

- getpid 获取进程号
- getppid 获取父进程的进程号

## shell如何运行程序

- shell本身是一个进程
- exit可以退出shell
- shell是一个无穷循环,等待执行输入的命令,程序或脚本
- 执行一条命令的过程
  - 接受输入的命令
  - 新建一个进程,用来运行该命令
  - 将命令对应的程序从磁盘中加载到新进程中执行
  - 等待新进程运行结束

- 产生新进程 fork vfork
- 执行命令 exec
- 等待子进程结束 wait waitpid

## fork

- 功能:产生一个新的进程
- 头文件: /usr/include/unistd.h
- 返回值: -1 创建失败(父进程) >0 子进程(父进程) 0 创建成功(子进程)
用户程序调用fork后,fork调用内核的forkdiamagnetic,完成以下工作:

1. 分配新的内存块和内核数据结构
2. 复制父进程的信息到新进程空间中(数据区,堆栈,一些属性)
3. 向运行进程组中添加新的进程
4. 将控制返回给父子两个进程

## execvp

- 总共有六个函数 execlp execvp execv execl execle execve,真正的系统调用只有execve
- 执行程序时会替换程序的上下文(执行成功时不会回到源程序中,而是回到它执行的程序中)
- 执行过程
  1. 用户进程调用execvp
  2. 内核按照程序名,将程序的内容加载奥用户进程空间
  3. 内核将参数表argv复制到进程中
  4. 内核调用新加载程序的main(argc, argv)
  5. 同时还会调整进程的内存分配使之适应新的程序对内存的要求
